{% extends "layout.html" %}


{% block content %}
    <h2>Dashboard</h2>
    <h3>Items</h3>
    <div class="ui divided items">
        {% for item in items %}
        <div class="item">
            <div class="image">
                <img src="{{ item.image_url }}" alt="Image of {{ item.name }}">
            </div>
            <div class="content">
                <a class="header">Item Name: {{ item.product_name }}</a>
                <div class="description">
                    <p>
                        Date Added: {{ item.date_added }}<br>
                        Expiration Date: {{ item.expiration_date }}<br>
                    </p>
                </div>
                <div class="extra">
                    <div class="ui right floated negative labeled icon button" onclick="deleteItem('{{ user_id }}', '{{ item.upc_code }}', '{{ loop.index0 }}')">
                        Delete
                        <i class="minus icon"></i> 
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>




    <script>
        // Define the deleteItem function globally
        async function deleteItem(userId, code, index) {
            const formData = new FormData();
            formData.append("user_id", userId);
            formData.append("code", code);
            formData.append("action", "DELETE");
            formData.append("index", index);
    
            const response = await fetch("http://127.0.0.1:5000/api/update", { // Updated port to 5000
                method: "POST",
                body: formData,
            });
            
            if (response.ok) {
                alert("Item deleted successfully!");
                location.reload();
            } else {
                const error = await response.json();
                alert(`Error: ${error.error}`);
            }
        }
    
        document.addEventListener("DOMContentLoaded", () => {
            // Additional DOM-related logic can go here if needed
        });
    </script>

    
{% endblock %}




